<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #mp37693cfc748049e45d87b8c7d8b9aacd {
            max-width:600px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd * {
            box-sizing: border-box;
            font-size: 14px;
            font-family: sans-serif;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item {
            width: 100%;
            padding: 8px 0;
            min-height: 42px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item_inline {
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item_inline .form__label {
            margin: 0 16px 0 0;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item:last-child {
            margin-bottom: 0;
        }

        /* кнопка */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__button {
            display: block;
            margin: 0 auto;
            cursor: pointer;
            border: none;
            text-align: center;
            font-weight: 500;
            color: white;
            padding: 11px 16px;
            background: #0D6EFD;
            border-radius: 4px;
            filter: drop-shadow(0px 10px 15px rgba(13, 110, 253, 0.3)) drop-shadow(0px 5px 5px rgba(13, 110, 253, 0.2)) drop-shadow(0px 2px 2px rgba(13, 110, 253, 0.2));
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__button.form__button_disabled {
            background: #aeaeae;
            filter: drop-shadow(0px 10px 15px rgba(110, 110, 110, 0.3)) drop-shadow(0px 5px 5px rgba(110, 110, 110, 0.2)) drop-shadow(0px 2px 2px rgba(110, 110, 110, 0.2));
        }

        /* инпут */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__input {
            outline: none;
            width: 100%;
            color: #494949;;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        /* выпадающий список и все для него */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown {
            position: relative;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__header {
            cursor: pointer;
            display: block;
            position: relative;
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
            height: 34px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__header::after {
            display: block;
            content: '';
            border: 5px solid transparent;
            border-top: 5px solid #939393;
            position: absolute;
            top: 14px;
            right: 14px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__header::after {
            transform: rotate(180deg) translateY(5px);
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__content {
            display: none;
            position: absolute;
            width: 100%;
            z-index: 2;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__content {
            display: block;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__option {
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            cursor: pointer;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__option:first-child {
            border-radius: 4px 4px 0 0;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__option:last-child {
            border-radius: 0 0 4px 4px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__dropdown__option:hover {
            background: #0D6EFD;
            color: white;
        }

        /* Чекбокс и все для него */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox {
            width: 24px;
            height: 24px;
            display: block;
            position: relative;
            cursor: pointer;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox__icon {
            display: block;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon {
            display: none;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox__icon_checked {
            display: none;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon_checked {
            display: block;
        }

        /* лейбл */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__label {
            margin: 0;
            margin-bottom: 4px;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__label_required::after {
            position: relative;
            content: ' *';
            color: red;
        }

        /* ошибка */
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__error {
            color: red;
            display: none;
            text-align: center;
        }

        /* успешный текст */
        #mp37693cfc748049e45d87b8c7d8b9aacd .success {
            padding: 20px 24px;
            text-align: center;
            font-size: 32px;
            display: none;
        }

        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item.error input {
            border-color: red;
        }
        #mp37693cfc748049e45d87b8c7d8b9aacd .form__item .form__error {
            font-size: 12px;
            display: none;
            color: red;
            text-align: left;
            margin: 2px 0 0;
        }










        /* ********************************************************** */


        #mp1ff1de774005f8da13f42943881c655f {
            max-width:600px;
        }

        #mp1ff1de774005f8da13f42943881c655f * {
            box-sizing: border-box;
            font-size: 14px;
            font-family: sans-serif;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__item {
            width: 100%;
            padding: 8px 0;
            min-height: 42px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__item_inline {
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__item_inline .form__label {
            margin: 0 16px 0 0;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__item:last-child {
            margin-bottom: 0;
        }

        /* кнопка */
        #mp1ff1de774005f8da13f42943881c655f .form__button {
            display: block;
            margin: 0 auto;
            cursor: pointer;
            border: none;
            text-align: center;
            font-weight: 500;
            color: white;
            padding: 11px 16px;
            background: #0D6EFD;
            border-radius: 4px;
            filter: drop-shadow(0px 10px 15px rgba(13, 110, 253, 0.3)) drop-shadow(0px 5px 5px rgba(13, 110, 253, 0.2)) drop-shadow(0px 2px 2px rgba(13, 110, 253, 0.2));
        }

        #mp1ff1de774005f8da13f42943881c655f .form__button.form__button_disabled {
            background: #aeaeae;
            filter: drop-shadow(0px 10px 15px rgba(110, 110, 110, 0.3)) drop-shadow(0px 5px 5px rgba(110, 110, 110, 0.2)) drop-shadow(0px 2px 2px rgba(110, 110, 110, 0.2));
        }

        /* инпут */
        #mp1ff1de774005f8da13f42943881c655f .form__input {
            outline: none;
            width: 100%;
            color: #494949;;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        /* выпадающий список и все для него */
        #mp1ff1de774005f8da13f42943881c655f .form__dropdown {
            position: relative;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__header {
            cursor: pointer;
            display: block;
            position: relative;
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
            height: 34px;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__header::after {
            display: block;
            content: '';
            border: 5px solid transparent;
            border-top: 5px solid #939393;
            position: absolute;
            top: 14px;
            right: 14px;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__header::after {
            transform: rotate(180deg) translateY(5px);
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__content {
            display: none;
            position: absolute;
            width: 100%;
            z-index: 2;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__content {
            display: block;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__option {
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            cursor: pointer;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__option:first-child {
            border-radius: 4px 4px 0 0;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__option:last-child {
            border-radius: 0 0 4px 4px;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__dropdown__option:hover {
            background: #0D6EFD;
            color: white;
        }

        /* Чекбокс и все для него */
        #mp1ff1de774005f8da13f42943881c655f .form__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__checkbox {
            width: 24px;
            height: 24px;
            display: block;
            position: relative;
            cursor: pointer;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__checkbox__icon {
            display: block;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon {
            display: none;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__checkbox__icon_checked {
            display: none;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon_checked {
            display: block;
        }

        /* лейбл */
        #mp1ff1de774005f8da13f42943881c655f .form__label {
            margin: 0;
            margin-bottom: 4px;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__label_required::after {
            position: relative;
            content: ' *';
            color: red;
        }

        /* ошибка */
        #mp1ff1de774005f8da13f42943881c655f .form__error {
            color: red;
            display: none;
            text-align: center;
        }

        /* успешный текст */
        #mp1ff1de774005f8da13f42943881c655f .success {
            padding: 20px 24px;
            text-align: center;
            font-size: 32px;
            display: none;
        }

        #mp1ff1de774005f8da13f42943881c655f .form__item.error input {
            border-color: red;
        }
        #mp1ff1de774005f8da13f42943881c655f .form__item .form__error {
            font-size: 12px;
            display: none;
            color: red;
            text-align: left;
            margin: 2px 0 0;
        }

        /* ******************************** */

        #mp8e296a067a37563370ded05f5a3bf3ec {
            max-width:600px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec * {
            box-sizing: border-box;
            font-size: 14px;
            font-family: sans-serif;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__item {
            width: 100%;
            padding: 8px 0;
            min-height: 42px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__item_inline {
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__item_inline .form__label {
            margin: 0 16px 0 0;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__item:last-child {
            margin-bottom: 0;
        }

        /* кнопка */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__button {
            display: block;
            margin: 0 auto;
            cursor: pointer;
            border: none;
            text-align: center;
            font-weight: 500;
            color: white;
            padding: 11px 16px;
            background: #0D6EFD;
            border-radius: 4px;
            filter: drop-shadow(0px 10px 15px rgba(13, 110, 253, 0.3)) drop-shadow(0px 5px 5px rgba(13, 110, 253, 0.2)) drop-shadow(0px 2px 2px rgba(13, 110, 253, 0.2));
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__button.form__button_disabled {
            background: #aeaeae;
            filter: drop-shadow(0px 10px 15px rgba(110, 110, 110, 0.3)) drop-shadow(0px 5px 5px rgba(110, 110, 110, 0.2)) drop-shadow(0px 2px 2px rgba(110, 110, 110, 0.2));
        }

        /* инпут */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__input {
            outline: none;
            width: 100%;
            color: #494949;;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        /* выпадающий список и все для него */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown {
            position: relative;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__header {
            cursor: pointer;
            display: block;
            position: relative;
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
            height: 34px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__header::after {
            display: block;
            content: '';
            border: 5px solid transparent;
            border-top: 5px solid #939393;
            position: absolute;
            top: 14px;
            right: 14px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__header::after {
            transform: rotate(180deg) translateY(5px);
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__content {
            display: none;
            position: absolute;
            width: 100%;
            z-index: 2;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__content {
            display: block;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__option {
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            cursor: pointer;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__option:first-child {
            border-radius: 4px 4px 0 0;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__option:last-child {
            border-radius: 0 0 4px 4px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__dropdown__option:hover {
            background: #0D6EFD;
            color: white;
        }

        /* Чекбокс и все для него */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox {
            width: 24px;
            height: 24px;
            display: block;
            position: relative;
            cursor: pointer;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox__icon {
            display: block;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon {
            display: none;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox__icon_checked {
            display: none;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon_checked {
            display: block;
        }

        /* лейбл */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__label {
            margin: 0;
            margin-bottom: 4px;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__label_required::after {
            position: relative;
            content: ' *';
            color: red;
        }

        /* ошибка */
        #mp8e296a067a37563370ded05f5a3bf3ec .form__error {
            color: red;
            display: none;
            text-align: center;
        }

        /* успешный текст */
        #mp8e296a067a37563370ded05f5a3bf3ec .success {
            padding: 20px 24px;
            text-align: center;
            font-size: 32px;
            display: none;
        }

        #mp8e296a067a37563370ded05f5a3bf3ec .form__item.error input {
            border-color: red;
        }
        #mp8e296a067a37563370ded05f5a3bf3ec .form__item .form__error {
            font-size: 12px;
            display: none;
            color: red;
            text-align: left;
            margin: 2px 0 0;
        }

    </style>
</head>
<body>
<div style="border: 1px solid green">
    <section id="mp37693cfc748049e45d87b8c7d8b9aacd" >
        <div class="form">
            <div class="form__item item__name">
                <p class="form__label form__label_required">Название</p>
                <input type="text"
                       class="form__input"
                       placeholder="Название">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__phone">
                <p class="form__label form__label_required">Телефон</p>
                <input type="tel"
                       class="form__input"
                       placeholder="Телефон">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__email">
                <p class="form__label form__label_required">Email</p>
                <input type="email"
                       class="form__input"
                       placeholder="Email">
                <p class="form__error"></p>
            </div>
            <div class="form__item">
                <button class="form__button">Отправить</button>
            </div>
            <div class="form__item form__error"></div>
        </div>
        <div class="success">
            <p></p>
            <div class="form__item">
                <button class="form__button form__restart">Ok</button>
            </div>
        </div>
    </section>
    <script>
      (function () {
        let isFormLocked = false;

        const formType = 'contractor'
        const contractorType = 'company'
        const formId = 'mp37693cfc748049e45d87b8c7d8b9aacd'

        const formRootElement = document.querySelector('#' + formId)
        const submitButton = formRootElement.querySelector('.form .form__button')
        const restartButton = formRootElement.querySelector('.form__restart')
        const phoneInputs = formRootElement.querySelectorAll('.form__item [type="tel"]')
        const successText = formRootElement.querySelector('.success')
        const formElement = formRootElement.querySelector('.form')
        const formError = formRootElement.querySelector('.form .form__item.form__error')

        const formData = {
          'name': {
            name: 'name',
            value: null,
            validators: [
              requiredValidator,                                                        ],
            type: 'input'
          },
          'phone': {
            name: 'phone',
            value: null,
            validators: [
              requiredValidator,                                        phoneValidator,                ],
            type: 'phone'
          },
          'email': {
            name: 'email',
            value: null,
            validators: [
              requiredValidator,                    emailValidator,                                    ],
            type: 'email'
          },
        }

        initForm()

        function initForm() {
          phoneInputs.forEach(element => element.addEventListener('input', phoneInputHandler, false))
          restartButton.addEventListener('click', clearForm)
          submitButton.onclick = submitHandler
          initFields();
        }

        function initFields() {
          Object.values(formData).map(item => {
            switch (item.type) {
              case 'email':
              case 'phone':
                const contactElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                contactElement.oninput = function () {
                  setField(item.name,
                          {
                            contentType: 'ContactInfo',
                            type: item.type,
                            value: contactElement.value.trim()
                          }
                  )
                }
                break;
              case 'input':
                const inputElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                inputElement.oninput = function () {
                  setField(item.name, inputElement.value)
                }
                break;
              case 'float':
                const floatElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                floatElement.oninput = function () {
                  setField(item.name, parseFloat(floatElement.value))
                }
                break;
              case 'dropdown':
                const dropdownElements = formRootElement.querySelectorAll('.form__item.item__' + item.name + ' .form__dropdown .form__dropdown__option')
                dropdownElements.forEach(element => {
                  element.addEventListener('click', function () {
                    setField(item.name, this.dataset.value)
                  })
                })
                break;
              case 'checkbox':
                const checkboxElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__checkbox_hidden')
                checkboxElement.oninput = function () {
                  setField(item.name, checkboxElement.checked)
                }
                break;

            }
          })
        }

        function clearForm() {
          successText.style.display = 'none'
          successText.querySelector('p').innerHTML = ''

          formElement.style.display = 'block'

          Object.keys(formData).forEach(key => formData[key].value = null)
          formRootElement.querySelectorAll('.form .form__dropdown__header').forEach((header) => header.innerHTML = '')
          formRootElement.querySelectorAll('.form .form__input').forEach(input => input.value = '')

          unLockButton()
        }

        function showError(text) {
          formError.style.display = 'block'
          formError.innerHTML = text
          unLockButton()
        }

        function hideError() {
          formError.style.display = 'none'

          formRootElement.querySelectorAll('.form .error')
                  .forEach(element => element.classList.remove('error'))

          formRootElement.querySelectorAll('.form .form__error')
                  .forEach(errorField => {
                    errorField.style.display = 'none';
                    errorField.innerHTML = '';
                  })
        }

        function showSuccess(text) {
          formElement.style.display = 'none'
          successText.style.display = 'block'
          successText.querySelector('p').innerHTML = text
          unLockButton()
        }

        function setField(fieldName, value) {
          hideError()
          formData[fieldName].value = value
        }

        function getContentTypeForContractor(contractorType) {
          return contractorType === 'human' ? 'ContractorHuman': 'ContractorCompany'
        }

        async function submitHandler() {
          if (isFormLocked) {
            return
          }

          lockButton()

          const fields = Object.values(formData)

          const isValid = fields.map(
                  item => item.validators.map(
                          validator => {
                            const validateError = validator(item.value)
                            if (validateError) {
                              formRootElement.querySelector('.form .item__' + item.name).classList.add('error')
                              const errField = formRootElement.querySelector('.form .item__' + item.name + ' .form__error');
                              errField.innerHTML = validateError
                              errField.style.display = 'block'
                            }
                            return !validateError
                          }
                  ).filter(Boolean).length === item.validators.length
          ).filter(Boolean).length === fields.length


          const contactInfo = [];

          if (isValid) {
            const request = fields.reduce((dataObj, item) => {
              if (['email', 'phone'].includes(item.type)) {
                if (item.value?.value?.trim()) {
                  contactInfo.push(item.value)
                }
                return dataObj
              }

              if (item.name.startsWith("contractor.")) {
                if (!dataObj.contractor) {
                  dataObj.contractor = {
                    contentType: getContentTypeForContractor(contractorType)
                  }
                }

                dataObj.contractor[item.name.replace("contractor.", "")] = item.value
              } else {
                dataObj[item.name] = item.value
              }
              return dataObj
            }, {})

            if (formType === 'deal') {
              request.contentType = 'Deal'
              if (!!request.contractor) {
                request.contractor.contactInfo = contactInfo
              }
            } else {
              request.contentType = getContentTypeForContractor(contractorType)
              request.contactInfo = contactInfo
            }

            fetch('https://ra.megaplan.ru/api/v3/customLeadForm/23/process/contractor', {
              method: 'POST',
              headers: {
                'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(request)
            })
                    .then((response) => {
                      if (!response.ok) {
                        throw Error(response.statusText);
                      }

                      showSuccess('Данные успешно отправлены')
                    })
                    .catch(() => showError('При отправке формы произошла ошибка. Попробуйте позже.'))

          } else {
            unLockButton()
          }
        }

        function lockButton() {
          isFormLocked = true;

          submitButton.classList.add('form__button_disabled')
          submitButton.onclick = null
        }

        function unLockButton() {
          isFormLocked = false;
          submitButton.classList.remove('form__button_disabled')
          submitButton.onclick = submitHandler
        }

        function phoneInputHandler(e) {
          e.target.value = e.target.value.replace(/[^\d\()\-\+]/g, '');
        }

        function requiredValidator(value) {
          return !value ? 'Поле обязательно для заполнения' : ''
        }

        function emailValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /.+@.+\..+/i
          ) ? 'Некорректный email' : ''
        }

        function phoneValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /^\+?[\d()\-\s]+$/
          ) ? 'Некорректный номер телефона' : ''
        }
      })();
    </script>

</div>
<div style="border: 1px solid green">
    <section id="mp1ff1de774005f8da13f42943881c655f" >
        <div class="form">
            <div class="form__item item__firstName">
                <p class="form__label form__label_required">Имя</p>
                <input type="text"
                       class="form__input"
                       placeholder="Имя">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__lastName">
                <p class="form__label form__label_required">Фамилия</p>
                <input type="text"
                       class="form__input"
                       placeholder="Фамилия">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__phone">
                <p class="form__label">Телефон</p>
                <input type="tel"
                       class="form__input"
                       placeholder="Телефон">
                <p class="form__error"></p>
            </div>
            <div class="form__item">
                <button class="form__button">Отправить</button>
            </div>
            <div class="form__item form__error"></div>
        </div>
        <div class="success">
            <p></p>
            <div class="form__item">
                <button class="form__button form__restart">Ok</button>
            </div>
        </div>
    </section>
    <script>
      (function () {
        let isFormLocked = false;

        const formType = 'contractor'
        const contractorType = 'human'
        const formId = 'mp1ff1de774005f8da13f42943881c655f'

        const formRootElement = document.querySelector('#' + formId)
        const submitButton = formRootElement.querySelector('.form .form__button')
        const restartButton = formRootElement.querySelector('.form__restart')
        const phoneInputs = formRootElement.querySelectorAll('.form__item [type="tel"]')
        const successText = formRootElement.querySelector('.success')
        const formElement = formRootElement.querySelector('.form')
        const formError = formRootElement.querySelector('.form .form__item.form__error')

        const formData = {
          'firstName': {
            name: 'firstName',
            value: null,
            validators: [
              requiredValidator,                                                        ],
            type: 'input'
          },
          'lastName': {
            name: 'lastName',
            value: null,
            validators: [
              requiredValidator,                                                        ],
            type: 'input'
          },
          'phone': {
            name: 'phone',
            value: null,
            validators: [
              phoneValidator,                ],
            type: 'phone'
          },
        }

        initForm()

        function initForm() {
          phoneInputs.forEach(element => element.addEventListener('input', phoneInputHandler, false))
          restartButton.addEventListener('click', clearForm)
          submitButton.onclick = submitHandler
          initFields();
        }

        function initFields() {
          Object.values(formData).map(item => {
            switch (item.type) {
              case 'email':
              case 'phone':
                const contactElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                contactElement.oninput = function () {
                  setField(item.name,
                          {
                            contentType: 'ContactInfo',
                            type: item.type,
                            value: contactElement.value.trim()
                          }
                  )
                }
                break;
              case 'input':
                const inputElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                inputElement.oninput = function () {
                  setField(item.name, inputElement.value)
                }
                break;
              case 'float':
                const floatElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                floatElement.oninput = function () {
                  setField(item.name, parseFloat(floatElement.value))
                }
                break;
              case 'dropdown':
                const dropdownElements = formRootElement.querySelectorAll('.form__item.item__' + item.name + ' .form__dropdown .form__dropdown__option')
                dropdownElements.forEach(element => {
                  element.addEventListener('click', function () {
                    setField(item.name, this.dataset.value)
                  })
                })
                break;
              case 'checkbox':
                const checkboxElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__checkbox_hidden')
                checkboxElement.oninput = function () {
                  setField(item.name, checkboxElement.checked)
                }
                break;

            }
          })
        }

        function clearForm() {
          successText.style.display = 'none'
          successText.querySelector('p').innerHTML = ''

          formElement.style.display = 'block'

          Object.keys(formData).forEach(key => formData[key].value = null)
          formRootElement.querySelectorAll('.form .form__dropdown__header').forEach((header) => header.innerHTML = '')
          formRootElement.querySelectorAll('.form .form__input').forEach(input => input.value = '')

          unLockButton()
        }

        function showError(text) {
          formError.style.display = 'block'
          formError.innerHTML = text
          unLockButton()
        }

        function hideError() {
          formError.style.display = 'none'

          formRootElement.querySelectorAll('.form .error')
                  .forEach(element => element.classList.remove('error'))

          formRootElement.querySelectorAll('.form .form__error')
                  .forEach(errorField => {
                    errorField.style.display = 'none';
                    errorField.innerHTML = '';
                  })
        }

        function showSuccess(text) {
          formElement.style.display = 'none'
          successText.style.display = 'block'
          successText.querySelector('p').innerHTML = text
          unLockButton()
        }

        function setField(fieldName, value) {
          hideError()
          formData[fieldName].value = value
        }

        function getContentTypeForContractor(contractorType) {
          return contractorType === 'human' ? 'ContractorHuman': 'ContractorCompany'
        }

        async function submitHandler() {
          if (isFormLocked) {
            return
          }

          lockButton()

          const fields = Object.values(formData)

          const isValid = fields.map(
                  item => item.validators.map(
                          validator => {
                            const validateError = validator(item.value)
                            if (validateError) {
                              formRootElement.querySelector('.form .item__' + item.name).classList.add('error')
                              const errField = formRootElement.querySelector('.form .item__' + item.name + ' .form__error');
                              errField.innerHTML = validateError
                              errField.style.display = 'block'
                            }
                            return !validateError
                          }
                  ).filter(Boolean).length === item.validators.length
          ).filter(Boolean).length === fields.length


          const contactInfo = [];

          if (isValid) {
            const request = fields.reduce((dataObj, item) => {
              if (['email', 'phone'].includes(item.type)) {
                if (item.value?.value?.trim()) {
                  contactInfo.push(item.value)
                }
                return dataObj
              }

              if (item.name.startsWith("contractor.")) {
                if (!dataObj.contractor) {
                  dataObj.contractor = {
                    contentType: getContentTypeForContractor(contractorType)
                  }
                }

                dataObj.contractor[item.name.replace("contractor.", "")] = item.value
              } else {
                dataObj[item.name] = item.value
              }
              return dataObj
            }, {})

            if (formType === 'deal') {
              request.contentType = 'Deal'
              if (!!request.contractor) {
                request.contractor.contactInfo = contactInfo
              }
            } else {
              request.contentType = getContentTypeForContractor(contractorType)
              request.contactInfo = contactInfo
            }

            fetch('https://ra.megaplan.ru/api/v3/customLeadForm/24/process/contractor', {
              method: 'POST',
              headers: {
                'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(request)
            })
                    .then((response) => {
                      if (!response.ok) {
                        throw Error(response.statusText);
                      }

                      showSuccess('Данные успешно отправлены')
                    })
                    .catch(() => showError('При отправке формы произошла ошибка. Попробуйте позже.'))

          } else {
            unLockButton()
          }
        }

        function lockButton() {
          isFormLocked = true;

          submitButton.classList.add('form__button_disabled')
          submitButton.onclick = null
        }

        function unLockButton() {
          isFormLocked = false;
          submitButton.classList.remove('form__button_disabled')
          submitButton.onclick = submitHandler
        }

        function phoneInputHandler(e) {
          e.target.value = e.target.value.replace(/[^\d\()\-\+]/g, '');
        }

        function requiredValidator(value) {
          return !value ? 'Поле обязательно для заполнения' : ''
        }

        function emailValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /.+@.+\..+/i
          ) ? 'Некорректный email' : ''
        }

        function phoneValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /^\+?[\d()\-\s]+$/
          ) ? 'Некорректный номер телефона' : ''
        }
      })();
    </script>


</div>
<div style="border: 1px solid green">
    <section id="mp8e296a067a37563370ded05f5a3bf3ec" >
        <div class="form">
            <div class="form__item item__description">
                <p class="form__label">Суть</p>
                <input type="text"
                       class="form__input"
                       placeholder="Суть">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__contractor.firstName">
                <p class="form__label form__label_required">Имя</p>
                <input type="text"
                       class="form__input"
                       placeholder="Имя">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__contractor.lastName">
                <p class="form__label form__label_required">Фамилия</p>
                <input type="text"
                       class="form__input"
                       placeholder="Фамилия">
                <p class="form__error"></p>
            </div>
            <div class="form__item item__contractor.phone">
                <p class="form__label form__label_required">Телефон</p>
                <input type="tel"
                       class="form__input"
                       placeholder="Телефон">
                <p class="form__error"></p>
            </div>
            <div class="form__item">
                <button class="form__button">Отправить</button>
            </div>
            <div class="form__item form__error"></div>
        </div>
        <div class="success">
            <p></p>
            <div class="form__item">
                <button class="form__button form__restart">Ok</button>
            </div>
        </div>
    </section>
    <script>
      (function () {
        let isFormLocked = false;

        const formType = 'deal'
        const contractorType = 'human'
        const formId = 'mp8e296a067a37563370ded05f5a3bf3ec'

        const formRootElement = document.querySelector('#' + formId)
        const submitButton = formRootElement.querySelector('.form .form__button')
        const restartButton = formRootElement.querySelector('.form__restart')
        const phoneInputs = formRootElement.querySelectorAll('.form__item [type="tel"]')
        const successText = formRootElement.querySelector('.success')
        const formElement = formRootElement.querySelector('.form')
        const formError = formRootElement.querySelector('.form .form__item.form__error')

        const formData = {
          'description': {
            name: 'description',
            value: null,
            validators: [
            ],
            type: 'input'
          },
          'contractor.firstName': {
            name: 'contractor.firstName',
            value: null,
            validators: [
              requiredValidator,                                                        ],
            type: 'input'
          },
          'contractor.lastName': {
            name: 'contractor.lastName',
            value: null,
            validators: [
              requiredValidator,                                                        ],
            type: 'input'
          },
          'contractor.phone': {
            name: 'contractor.phone',
            value: null,
            validators: [
              requiredValidator,                                        phoneValidator,                ],
            type: 'phone'
          },
        }

        initForm()

        function initForm() {
          phoneInputs.forEach(element => element.addEventListener('input', phoneInputHandler, false))
          restartButton.addEventListener('click', clearForm)
          submitButton.onclick = submitHandler
          initFields();
        }

        function initFields() {
          Object.values(formData).map(item => {
            switch (item.type) {
              case 'email':
              case 'phone':
                const contactElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                contactElement.oninput = function () {
                  setField(item.name,
                          {
                            contentType: 'ContactInfo',
                            type: item.type,
                            value: contactElement.value.trim()
                          }
                  )
                }
                break;
              case 'input':
                const inputElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                inputElement.oninput = function () {
                  setField(item.name, inputElement.value)
                }
                break;
              case 'float':
                const floatElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__input')
                floatElement.oninput = function () {
                  setField(item.name, parseFloat(floatElement.value))
                }
                break;
              case 'dropdown':
                const dropdownElements = formRootElement.querySelectorAll('.form__item.item__' + item.name + ' .form__dropdown .form__dropdown__option')
                dropdownElements.forEach(element => {
                  element.addEventListener('click', function () {
                    setField(item.name, this.dataset.value)
                  })
                })
                break;
              case 'checkbox':
                const checkboxElement = formRootElement.querySelector('.form__item.item__' + item.name + ' .form__checkbox_hidden')
                checkboxElement.oninput = function () {
                  setField(item.name, checkboxElement.checked)
                }
                break;

            }
          })
        }

        function clearForm() {
          successText.style.display = 'none'
          successText.querySelector('p').innerHTML = ''

          formElement.style.display = 'block'

          Object.keys(formData).forEach(key => formData[key].value = null)
          formRootElement.querySelectorAll('.form .form__dropdown__header').forEach((header) => header.innerHTML = '')
          formRootElement.querySelectorAll('.form .form__input').forEach(input => input.value = '')

          unLockButton()
        }

        function showError(text) {
          formError.style.display = 'block'
          formError.innerHTML = text
          unLockButton()
        }

        function hideError() {
          formError.style.display = 'none'

          formRootElement.querySelectorAll('.form .error')
                  .forEach(element => element.classList.remove('error'))

          formRootElement.querySelectorAll('.form .form__error')
                  .forEach(errorField => {
                    errorField.style.display = 'none';
                    errorField.innerHTML = '';
                  })
        }

        function showSuccess(text) {
          formElement.style.display = 'none'
          successText.style.display = 'block'
          successText.querySelector('p').innerHTML = text
          unLockButton()
        }

        function setField(fieldName, value) {
          hideError()
          formData[fieldName].value = value
        }

        function getContentTypeForContractor(contractorType) {
          return contractorType === 'human' ? 'ContractorHuman': 'ContractorCompany'
        }

        async function submitHandler() {
          if (isFormLocked) {
            return
          }

          lockButton()

          const fields = Object.values(formData)

          const isValid = fields.map(
                  item => item.validators.map(
                          validator => {
                            const validateError = validator(item.value)
                            if (validateError) {
                              formRootElement.querySelector('.form .item__' + item.name).classList.add('error')
                              const errField = formRootElement.querySelector('.form .item__' + item.name + ' .form__error');
                              errField.innerHTML = validateError
                              errField.style.display = 'block'
                            }
                            return !validateError
                          }
                  ).filter(Boolean).length === item.validators.length
          ).filter(Boolean).length === fields.length


          const contactInfo = [];

          if (isValid) {
            const request = fields.reduce((dataObj, item) => {
              if (['email', 'phone'].includes(item.type)) {
                if (item.value?.value?.trim()) {
                  contactInfo.push(item.value)
                }
                return dataObj
              }

              if (item.name.startsWith("contractor.")) {
                if (!dataObj.contractor) {
                  dataObj.contractor = {
                    contentType: getContentTypeForContractor(contractorType)
                  }
                }

                dataObj.contractor[item.name.replace("contractor.", "")] = item.value
              } else {
                dataObj[item.name] = item.value
              }
              return dataObj
            }, {})

            if (formType === 'deal') {
              request.contentType = 'Deal'
              if (!!request.contractor) {
                request.contractor.contactInfo = contactInfo
              }
            } else {
              request.contentType = getContentTypeForContractor(contractorType)
              request.contactInfo = contactInfo
            }

            fetch('https://ra.megaplan.ru/api/v3/customLeadForm/25/process/deal', {
              method: 'POST',
              headers: {
                'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(request)
            })
                    .then((response) => {
                      if (!response.ok) {
                        throw Error(response.statusText);
                      }

                      showSuccess('Данные успешно отправлены')
                    })
                    .catch(() => showError('При отправке формы произошла ошибка. Попробуйте позже.'))

          } else {
            unLockButton()
          }
        }

        function lockButton() {
          isFormLocked = true;

          submitButton.classList.add('form__button_disabled')
          submitButton.onclick = null
        }

        function unLockButton() {
          isFormLocked = false;
          submitButton.classList.remove('form__button_disabled')
          submitButton.onclick = submitHandler
        }

        function phoneInputHandler(e) {
          e.target.value = e.target.value.replace(/[^\d\()\-\+]/g, '');
        }

        function requiredValidator(value) {
          return !value ? 'Поле обязательно для заполнения' : ''
        }

        function emailValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /.+@.+\..+/i
          ) ? 'Некорректный email' : ''
        }

        function phoneValidator(contactInfo) {
          return contactInfo && contactInfo.value && !contactInfo.value.match(
                  /^\+?[\d()\-\s]+$/
          ) ? 'Некорректный номер телефона' : ''
        }
      })();
    </script>



</div>


</body>
</html>
