<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #mpc4ca4238a0b923820dcc509a6f75849b * {
            box-sizing: border-box;
            font-size: 14px;
            font-family: sans-serif;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__item {
            width: 100%;
            padding: 8px 0;
            min-height: 42px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__item_inline {
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__item_inline .form__label {
            margin: 0 16px 0 0;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__item:last-child {
            margin-bottom: 0;
        }

        /* кнопка */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__button {
            display: block;
            margin: 0 auto;
            cursor: pointer;
            border: none;
            text-align: center;
            font-weight: 500;
            color: white;
            padding: 11px 16px;
            background: #0D6EFD;
            border-radius: 4px;
            filter: drop-shadow(0px 10px 15px rgba(13, 110, 253, 0.3)) drop-shadow(0px 5px 5px rgba(13, 110, 253, 0.2)) drop-shadow(0px 2px 2px rgba(13, 110, 253, 0.2));
        }

        /* инпут */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__input {
            outline: none;
            width: 100%;
            color: #494949;;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        /* выпадающий список и все для него */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown {
            position: relative;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__header {
            cursor: pointer;
            display: block;
            position: relative;
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__header::after {
            display: block;
            content: '';
            border: 5px solid transparent;
            border-top: 5px solid #939393;
            position: absolute;
            top: 14px;
            right: 14px;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__header::after {
            transform: rotate(180deg) translateY(5px);
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__content {
            display: none;
            position: absolute;
            width: 100%;
            z-index: 2;
            border: 1px solid #D4D4D4;
            border-radius: 4px;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__checkbox_hidden:checked ~ .form__dropdown__content {
            display: block;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__option {
            width: 100%;
            color: #494949;
            padding: 8px;
            background: #F7F7F7;
            cursor: pointer;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__option:first-child {
            border-radius: 4px 4px 0 0;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__option:last-child {
            border-radius: 0 0 4px 4px;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__dropdown__option:hover {
            background: #0D6EFD;
            color: white;
        }

        /* Чекбокс и все для него */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox_hidden {
            position: absolute;
            visibility: hidden;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox {
            width: 24px;
            height: 24px;
            display: block;
            position: relative;
            cursor: pointer;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox__icon {
            display: block;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon {
            display: none;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox__icon_checked {
            display: none;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__checkbox_hidden:checked ~ .form__checkbox .form__checkbox__icon_checked {
            display: block;
        }

        /* лейбл */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__label {
            margin: 0;
            margin-bottom: 4px;
        }

        #mpc4ca4238a0b923820dcc509a6f75849b .form__label_required::after {
            position: relative;
            content: ' *';
            color: red;
        }

        /* ошибка */
        #mpc4ca4238a0b923820dcc509a6f75849b .form__error {
            color: red;
            display: none;
            text-align: center;
        }

        /* успешный текст */
        #mpc4ca4238a0b923820dcc509a6f75849b .success {
            padding: 100px 24px;
            text-align: center;
            font-size: 32px;
            display: none;
        }

    </style>
</head>
<body>
<script>
  function requiredValidator(value) {
    return !!value
  }

  const formType = 'contractor'
  const contractorType = 'human'

  const formData = {
    'firstName': {
      name: 'firstName',
      value: null,
      validators: [requiredValidator]
    },
    'lastName': {
      name: 'lastName',
      value: null,
      validators: [requiredValidator]
    },
  }

  function showError(text) {
    const error = document.querySelector('#mpc4ca4238a0b923820dcc509a6f75849b.form .form__error')
    error.style.display = 'block'
    error.innerHTML = text
  }

  function hideError() {
    document.querySelector('#mpc4ca4238a0b923820dcc509a6f75849b.form .form__error').style.display = 'none'
  }

  function showSuccess(text) {
    document.querySelector('#mpc4ca4238a0b923820dcc509a6f75849b.form').style.display = 'none'
    const success = document.querySelector('.success')
    success.style.display = 'block'
    success.innerHTML = text
  }

  function setField(fieldName, value) {
    hideError()
    formData[fieldName].value = value
  }

  function getContentTypeForContractor(contractorType) {
    if (contractorType === 'human') {
      return 'ContractorHuman'
    }

    return 'ContractorCompany'
  }

  async function send() {
    const fields = Object.values(formData)

    const isValid = fields.map(
            item => item.validators.map(
                    validator => validator(item.value)
            ).filter(Boolean).length === item.validators.length
    ).filter(Boolean).length === fields.length


    if (isValid) {
      const request = fields.reduce((dataObj, item) => {
        if (item.name.startsWith("contractor.")) {
          if (!dataObj.contractor) {
            dataObj.contractor = {
              contentType: getContentTypeForContractor(contractorType)
            }
          }

          dataObj.contractor[item.name.replace("contractor.", "")] = item.value
        } else {
          dataObj[item.name] = item.value
        }
        return dataObj
      }, {})

      if (formType === 'deal') {
        request.contentType = 'Deal'
      } else {
        request.contentType = getContentTypeForContractor(contractorType)
      }

      fetch('https://ra.megaplan.ru/api/v3/customLeadForm/1/process/contractor', {
        method: 'POST',
        headers: {
          'Accept': 'application/json, text/plain, */*',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(request)
      }).then(() => showSuccess('Данные успешно отправлены'));
    } else {
      showError('Заполните все обязательные поля')
    }
  }
</script>
<section style="max-width:600px;">
    <div id="mpc4ca4238a0b923820dcc509a6f75849b" className="form">
        <div className="form__item">
            <p className="form__label form__label_required">Имя</p>
            <input type="text"
                   className="form__input"
                   placeholder="Имя"
                   onInput="setField('firstName', this.value)">
        </div>
        <div className="form__item">
            <p className="form__label form__label_required">Фамилия</p>
            <input type="text"
                   className="form__input"
                   placeholder="Фамилия"
                   onInput="setField('lastName', this.value)">
        </div>
        <div className="form__item" onClick="send()">
            <button className="form__button">Отправить</button>
        </div>
        <div className="form__item form__error"></div>
    </div>
    <div className="success"></div>
</section>
</body>
</html>
